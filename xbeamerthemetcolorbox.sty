% !TeX root = ./testing/xtest.tex
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% The tcolorbox inner theme
% A beamer inner theme which reproduces standard beamer blocks using tcolorboxes
% Maintained by samcarter
%
% Project repository and bug tracker:
% https://github.com/samcarter/beamertheme-tcolorbox
%
% Released under the LaTeX Project Public License v1.3c or later
% See https://www.latex-project.org/lppl.txt
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ProvidesPackage{xbeamerthemetcolorbox}[2025/04/14 version v1.0 Beamer blocks with tcolorboxes]

\RequirePackage{tcolorbox}
\tcbuselibrary{skins,hooks}

\providecommand\@secondofthree[3]{#2}

\tcbset{
  xbeamer@tcb@if/.code n args = {3}{%  
    \csname #1\endcsname\expandafter\@secondofthree\fi  
    \@secondoftwo{\pgfkeysalso{#2}}{\pgfkeysalso{#3}}%
  },
  xbeamer@tcb@iffirstlayer/.code 2 args = {%  
    \ifnum\c@tcblayer<2
      \expandafter\@secondoftwo
    \fi
    \@secondoftwo{\pgfkeysalso{#1}}{\pgfkeysalso{#2}}%
  }
}
\newif\ifxbeamer@tcb@rounded
\newif\ifxbeamer@tcb@shadow
\newif\ifxbeamer@tcb@shaded
\newif\ifxbeamer@tcb@showtitle
\newif\ifxbeamer@tcb@titlepage
\newif\ifxbeamer@tcb@blocks

\newcommand*{\tcbthemeoptions}{block}
\newcommand{\tcbthemeset}[1]{%
  \tcbset{block/.append style={#1}}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Theme Options
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{xkeyval}
\DeclareOptionX{shadow}[true]{
  \csname xbeamer@tcb@shadow#1\endcsname
}
\DeclareOptionX{rounded}[true]{
  \csname xbeamer@tcb@rounded#1\endcsname
  \csname xbeamer@tcb@shaded#1\endcsname
  \csname xbeamer@tcb@showtitlefalse\endcsname
}
\DeclareOptionX{shaded}[true]{
  \csname xbeamer@tcb@shaded#1\endcsname
}
\DeclareOptionX{showtitle}[true]{
  \csname xbeamer@tcb@showtitle#1\endcsname
}
\DeclareOptionX{titlepage}[true]{
  \csname xbeamer@tcb@titlepage#1\endcsname
}
\DeclareOptionX{blocks}[true]{
  \csname xbeamer@tcb@blocks#1\endcsname
}
\ExecuteOptionsX{
  shadow=false,
  rounded=false,
  shaded=false,
  showtitle=true,
  titlepage=true,
  blocks=true
}
\ProcessOptionsX

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% General Settings
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\tcbset{
  block/.style={
    enhanced,
    before title={\strut},
    before upper={\strut},
    left=0.05cm,
    right=0.05cm,
    boxrule=0cm,
    frame hidden,
    top=1.5mm,
    bottom=0.5mm,
    xbeamer@tcb@iffirstlayer={oversize=0mm}{},
    colbacktitle=structure!75!black,
    coltitle=white,
    colback=tcbcolbacktitle!10,
    xbeamer@tcb@if={ifxbeamer@tcb@rounded}{
      arc=1.3mm,
      top=0.8mm,
      toptitle=0.2mm,
      bottom=0mm
    }{
      sharpish corners
    },
    xbeamer@tcb@if={ifxbeamer@tcb@shaded}{
      title code app={
          \shade[top color=tcbcolbacktitle,bottom color=tcbcolback] (title.south west) rectangle ([yshift=-0.5mm]title.south east);
        }
    }{},
    xbeamer@tcb@if={ifxbeamer@tcb@shadow}{
      drop fuzzy shadow=black!90
    }{}
  },
  alertblock/.style={
    block,
    colbacktitle=alert!75!black,
    colback=tcbcolbacktitle!10,
  },
  exampleblock/.style={
    block,
    colbacktitle=example!75!black,
    colback=tcbcolbacktitle!10,
  },
  titlepage/.style={
    halign=center,
    enhanced,
    frame hidden,
    colback=white,
    xbeamer@tcb@if={ifxbeamer@tcb@rounded}{
      arc=1.3mm,
    }{
      sharpish corners
    }
  },
  titlepage-title/.style={
    titlepage,
    fontupper=\Large,
    colback=structure,
    colupper=white,
    boxsep=4mm,
    xbeamer@tcb@if={ifxbeamer@tcb@shadow}{
      drop fuzzy shadow=black!90
    }{}
  },
  titlepage-subtitle/.style={
    titlepage,
    fontupper=\large
  },
  titlepage-author/.style={
    titlepage
  },
  titlepage-institute/.style={
    titlepage,
    fontupper=\scriptsize
  },
  titlepage-date/.style={
    titlepage
  },
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Defining blocks
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifxbeamer@tcb@blocks
  \renewtcolorbox{block}[2][]{
    block,
    xbeamer@tcb@if={ifxbeamer@tcb@showtitle}{title={\mbox{}#2}}{title={#2}},
    #1
  }
  \newtcolorbox{alertblock}[2][]{
    alertblock,
    xbeamer@tcb@if={ifxbeamer@tcb@showtitle}{title={\mbox{}#2}}{title={#2}},
    #1
  }
  \newtcolorbox{exampleblock}[2][]{
    exampleblock,
    xbeamer@tcb@if={ifxbeamer@tcb@showtitle}{title={\mbox{}#2}}{title={#2}},
    #1
  }
\fi % if blocks

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% patch title page etc.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifxbeamer@tcb@titlepage
\ExplSyntaxOn
\DeclareTemplateInterface { titlepage-element } { xbeamer } { 1 }
  {
    after-skip : length = 0em ,
    before-skip : length = 0em ,
    tag-begin : tokenlist = ,
    tag-end : tokenlist = ,
    style : tokenlist = 
  }
\DeclareTemplateCode { titlepage-element } { xbeamer } { 1 }
  {
    after-skip  = \l__xbeamer_titlelem_after_skip ,
    before-skip = \l__xbeamer_titlelem_before_skip ,
    tag-begin   = \l__xbeamer_titlelem_tag_begin_tl ,
    tag-end     = \l__xbeamer_titlelem_tag_end_tl ,
    style       = \l__xbeamer_titlelem_style_tl ,
  }
  {
    \tl_if_empty:nF {#1}
      {
        \vspace { \l__xbeamer_titlelem_before_skip }
        \group_begin:
          \l__xbeamer_titlelem_tag_begin_tl
          \begin{tcolorbox}[\l__xbeamer_titlelem_style_tl]
          #1
          \end{tcolorbox}
          \l__xbeamer_titlelem_tag_end_tl
        \group_end:
        \vspace { \l__xbeamer_titlelem_after_skip }
      }
  }
\DeclareInstance { titlepage-element } { author } { xbeamer }
  { style = titlepage-author }
\DeclareInstance { titlepage-element } { date } { xbeamer }
  { style = titlepage-date }
\DeclareInstance { titlepage-element } { institute } { xbeamer }
  { style = titlepage-institute }
\DeclareInstance { titlepage-element } { title } { xbeamer }
  { style = titlepage-title }
\DeclareInstance { titlepage-element } { subtitle } { xbeamer }
  { style = titlepage-subtitle }  
\ExplSyntaxOff
\fi % if titlepage
